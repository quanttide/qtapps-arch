# 数据库

## 架构

基本思路是计算和分析数据库分离。其中：
- 业务数据库（OLTP）使用MySQL，具体为TDSQL-C的MySQL版本
- 分析数据库（OLAP）使用ClickHouse，具体为TDSQL-A的ClickHouse版本（还没有上线）；如果需要实时分析考虑Flink类，如果需要搜索考虑ElasticSearch类。
- 业务分析一体类数据库（HTAP）暂时不考虑，如果确实有场景需要（i.e. 大规模爬虫的实时计算）再考虑。

对于数据库的分类和选型如下：

![图片](./QtApps数据库架构.jpg)


## 权限控制

- 以（不同私有网络下的）实例为单位隔离预生产和生产环境。使用不同的腾讯云账号及API密钥，最好能为账号设置私有网络的访问权限。
- 以数据库为单位隔离不同服务的数据。使用不同的数据库账号，为每个账号设置本服务的数据库全部权限，其他数据库无权限，以API交换数据。比如，用户服务的数据库账号为qtuser，访问权限只有qtuser数据库；在数据库设置中配置数据库级别权限、不给全局权限即可，工单确认过目前只能手动操作。


## 权限分配规则

对于MySQL类型的数据库，主要需要对每个服务使用的数据库账号配置这个数据库有限的访问权限。

对每个Django应用，配置它对应的数据库名称和test_前缀加数据库名称，Django应用内部按照默认设置即可。


## 设置方法

在CynosDB -> 集群列表 -> 账号管理，分配对应数据的“对象级特权”，关闭“全局特权”。**全局特权优于对象级特权，开放全局特权即拥有所有数据库的访问权限**。目前只能手动配置，无法通过其他方法自动化配置。